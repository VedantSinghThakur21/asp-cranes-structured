<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quotation</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 20px;
      color: #333;
      background-color: #f9f9f9;
    }
    .header {
      text-align: center;
      border-bottom: 3px solid #444;
      padding-bottom: 10px;
      margin-bottom: 20px;
    }
    .header img {
      max-width: 100px;
      margin-bottom: 10px;
    }
    .header h1 {
      margin: 0;
      font-size: 24px;
      color: #222;
    }
    .company-info, .customer-info {
      margin-bottom: 20px;
      font-size: 14px;
    }
    .meta {
      margin-bottom: 20px;
      background: #eef;
      padding: 10px;
      border-radius: 6px;
      font-size: 14px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
      background: #fff;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      font-size: 14px;
    }
    table, th, td {
      border: 1px solid #ccc;
    }
    th {
      background: #444;
      color: #fff;
      text-align: center;
      font-size: 14px;
    }
    th, td {
      padding: 8px;
      word-wrap: break-word;
    }
    tbody tr:nth-child(even) {
      background: #f2f2f2;
    }
    .terms {
      margin-top: 20px;
      background: #fef7e0;
      padding: 15px;
      border-left: 4px solid #f1c40f;
      font-size: 13px;
    }
    .footer {
      margin-top: 40px;
      text-align: right;
      font-style: italic;
      font-size: 14px;
    }
    .action-btns {
      margin-bottom: 20px;
    }
    .btn {
      display: inline-block;
      margin-right: 10px;
      padding: 10px 20px;
      background: #007BFF;
      color: #fff;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      text-decoration: none;
    }
    .btn:hover {
      background: #0056b3;
    }
    /* Responsive Styling */
    @media (max-width: 768px) {
      body {
        margin: 10px;
      }
      table, th, td {
        font-size: 12px;
      }
      .header h1 {
        font-size: 20px;
      }
      .company-info, .customer-info, .meta, .terms, .footer {
        font-size: 12px;
      }
      .btn {
        width: 100%;
        padding: 12px;
        font-size: 16px;
        margin-bottom: 10px;
      }
    }
    @media (max-width: 480px) {
      table, thead, tbody, th, td, tr {
        display: block;
        width: 100%;
      }
      thead tr {
        display: none;
      }
      td {
        display: flex;
        justify-content: space-between;
        border: none;
        border-bottom: 1px solid #ccc;
        padding: 8px 5px;
      }
      td:before {
        content: attr(data-label);
        font-weight: bold;
        flex-basis: 50%;
      }
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body>
  <div class="header">
    <img src="logo-placeholder.png" alt="Company Logo">
    <h1>QUOTATION</h1>
  </div>

  <div class="action-btns">
    <button class="btn" onclick="window.print()">Print Quotation</button>
    <button class="btn" onclick="downloadPDF()">Download PDF</button>
  </div>

  <div id="quotation-content">
    <div class="company-info">
      <strong>{{company.name}}</strong><br>
      {{company.address}}<br>
      Phone: {{company.phone}} | Email: {{company.email}} | Website: {{company.website}}
    </div>

    <div class="meta">
      <p><strong>Quotation No:</strong> {{quotation.number}}</p>
      <p><strong>Date:</strong> {{quotation.date}}</p>
      <p><strong>Validity:</strong> {{quotation.validity}}</p>
    </div>

    <div class="customer-info">
      <p><strong>To:</strong></p>
      <p>{{customer.name}}<br>
         {{customer.company}}<br>
         {{customer.email}}</p>
    </div>

    <table id="items-table">
      <thead>
        <tr>
          <th>Description</th>
          <th>Qty</th>
          <th>Unit Price</th>
          <th>Total</th>
        </tr>
      </thead>
      <tbody>
        {% for item in items %}
        <tr>
          <td data-label="Description">{{item.description}}</td>
          <td data-label="Qty" class="qty">{{item.qty}}</td>
          <td data-label="Unit Price" class="price">{{item.price}}</td>
          <td data-label="Total" class="line-total"></td>
        </tr>
        {% endfor %}
        <tr>
          <td colspan="3" style="text-align:right;"><strong>Grand Total</strong></td>
          <td><strong id="grand-total"></strong></td>
        </tr>
      </tbody>
    </table>

    <div class="terms">
      <p><strong>Terms & Conditions:</strong></p>
      <p>{{terms}}</p>
    </div>

    <div class="footer">
      <p>Authorized Signatory</p>
      <p>[Company Stamp / Signature]</p>
    </div>
  </div>

  <script>
    // Calculate totals dynamically
    function calculateTotals() {
      const rows = document.querySelectorAll('#items-table tbody tr');
      let grandTotal = 0;
      rows.forEach((row, index) => {
        const qtyCell = row.querySelector('.qty');
        const priceCell = row.querySelector('.price');
        const totalCell = row.querySelector('.line-total');
        if (qtyCell && priceCell && totalCell) {
          const qty = parseFloat(qtyCell.textContent) || 0;
          const price = parseFloat(priceCell.textContent) || 0;
          const lineTotal = qty * price;
          totalCell.textContent = '₹' + lineTotal.toFixed(2);
          grandTotal += lineTotal;
        }
      });
      document.getElementById('grand-total').textContent = '₹' + grandTotal.toFixed(2);
    }

    calculateTotals();

    function downloadPDF() {
      const element = document.getElementById('quotation-content');
      const opt = {
        margin:       0.5,
        filename:     'quotation.pdf',
        image:        { type: 'jpeg', quality: 0.98 },
        html2canvas:  { scale: 2 },
        jsPDF:        { unit: 'in', format: 'a4', orientation: 'portrait' }
      };
      html2pdf().from(element).set(opt).save();
    }
  </script>
</body>
</html>
